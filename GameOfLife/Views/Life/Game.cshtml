@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <link href="~/Content/style.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>

    <script type="text/javascript">
        function GetCurrentField() {
            $.ajax
            ({
                dataType: "json",
                url: "/Life/GetCurrentField",
                type: "GET",
                cashe: false,
                success: function (data) {
                    DrawField(data);
                },
            });
        }

        function DrawField(field) {
            var st = "";
            //идем построчно; в field.CurrentField же массив хранится постолбцово
            for (var j = 0; j < field.height; j++) {
                for (var i = 0; i < field.width; i++) {
                    st += "<div id='x" + i + "y" + j + "' onclick='ChangeCell(" + i + ", " + j + ")'";
                    if (field.CurrentField[i * field.height + j] == true) {
                        st += " class='alive" +
                            +String(Math.floor(Math.random() * 3 + 1)) +
                            "'>";
                    } else {
                        st += " class='dead'>";
                    }
                    st += "</div>";
                }
                st += "<br>";
            }
            document.getElementById("Field").innerHTML = st;
        }

        function ChangeCell(x, y) {
            $.ajax
            ({
                dataType: "json",
                url: "/Life/ChangeCell",
                type: "POST",
                data: "x=" + x + "&y=" + y,
                cashe: false,
                success: function () {
                    var elem = document.getElementById("x" + x + "y" + y);
                    if (elem.getAttribute("class") == "dead") {
                        elem.setAttribute("class", "alive" + String(Math.floor(Math.random() * 3 + 1)));
                    } else {
                        elem.setAttribute("class", "dead");
                    }
                },
            });
        }

        function MakeMove(x, y) {
            $.ajax
            ({
                dataType: "json",
                url: "/Life/MakeMove",
                type: "GET",
                cashe: false,
                success: function(data) {
                    DrawField(data);
                },
            });
        }

        function ClearField() {
            $.ajax
            ({
                dataType: "json",
                url: "/Life/ClearField",
                type: "GET",
                cashe: false,
                success: function (data) {
                    DrawField(data);
                },
            });
        }

        //trnv note
        //переписать (проверка размера поля дожна быть не запросом, а внутри GetPlaner в контроллере) или убрать
        function GetPlaner() {
            $.ajax
            ({
                dataType: "json",
                url: "/Life/GetCurrentField",
                type: "GET",
                cashe: false,
                success: function (data) {
                    if (data.width < 3 || data.height < 3) {
                        alert('Слишком маленькое поле :(');
                        return;
                    } else {
                        $.ajax
                        ({
                            dataType: "json",
                            url: "/Life/GetPlaner",
                            type: "GET",
                            cashe: false,
                            success: function (data2) {
                                DrawField(data2);
                            },
                        });
                    }
                },
            });
        }

        $(document).ready(GetCurrentField());

    </script>

    <title>Игра</title>
</head>
<body>
    <input type="button" onclick="MakeMove()" value="MakeMove"/>
    <input type="button" onclick="ClearField()" value="ClearField"/>
    <input type="button" onclick="GetPlaner()" value="GetPlaner" />
    <br><br>
    <form id="Field" style="line-height: 0px">Form "Field"</form>
    <br>
    <a href="/Life">Назад</a>
</body>
</html>